,url,repository_url,labels_url,comments_url,events_url,html_url,id,node_id,number,title,user,labels,state,locked,assignee,assignees,milestone,comments,created_at,updated_at,closed_at,author_association,active_lock_reason,draft,pull_request,body,closed_by,reactions,timeline_url,performed_via_github_app,state_reason
0,https://api.github.com/repos/pandas-dev/pandas/issues/60100,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60100/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60100/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60100/events,https://github.com/pandas-dev/pandas/pull/60100,2611653602,PR_kwDOAA0YD85_xwaF,60100,"BUG: `read_csv` with chained fsspec TAR file and `compression=""infer""` fails with `tarfile.ReadError`","{'login': 'KevsterAmp', 'id': 109636487, 'node_id': 'U_kgDOBojrhw', 'avatar_url': 'https://avatars.githubusercontent.com/u/109636487?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/KevsterAmp', 'html_url': 'https://github.com/KevsterAmp', 'followers_url': 'https://api.github.com/users/KevsterAmp/followers', 'following_url': 'https://api.github.com/users/KevsterAmp/following{/other_user}', 'gists_url': 'https://api.github.com/users/KevsterAmp/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/KevsterAmp/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/KevsterAmp/subscriptions', 'organizations_url': 'https://api.github.com/users/KevsterAmp/orgs', 'repos_url': 'https://api.github.com/users/KevsterAmp/repos', 'events_url': 'https://api.github.com/users/KevsterAmp/events{/privacy}', 'received_events_url': 'https://api.github.com/users/KevsterAmp/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,0,2024-10-24T13:40:32Z,2024-10-24T13:41:28Z,,CONTRIBUTOR,,True,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60100', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60100', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60100.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60100.patch', 'merged_at': None}","- [x] closes #60028
- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [x] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60100/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60100/timeline,,
1,https://api.github.com/repos/pandas-dev/pandas/issues/60099,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60099/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60099/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60099/events,https://github.com/pandas-dev/pandas/issues/60099,2611628059,I_kwDOAA0YD86bqkgb,60099,BUG: Inconsistent output type in Excel for PeriodIndex in Index or MultiIndex,"{'login': 'pforero', 'id': 4202522, 'node_id': 'MDQ6VXNlcjQyMDI1MjI=', 'avatar_url': 'https://avatars.githubusercontent.com/u/4202522?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/pforero', 'html_url': 'https://github.com/pforero', 'followers_url': 'https://api.github.com/users/pforero/followers', 'following_url': 'https://api.github.com/users/pforero/following{/other_user}', 'gists_url': 'https://api.github.com/users/pforero/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/pforero/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/pforero/subscriptions', 'organizations_url': 'https://api.github.com/users/pforero/orgs', 'repos_url': 'https://api.github.com/users/pforero/repos', 'events_url': 'https://api.github.com/users/pforero/events{/privacy}', 'received_events_url': 'https://api.github.com/users/pforero/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-24T13:30:21Z,2024-10-24T13:30:21Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd

period_index = pd.period_range(start=""2006-10-06"", end=""2006-10-07"", freq=""D"")
pi_index = pd.Series(0, index=period_index)
pi_multi = pd.Series(0, index=pd.MultiIndex.from_arrays([period_index, [0, 0]]))

pi_index.to_excel(""index_as_date_openpyxl.xlsx"", engine=""openpyxl"", index=True)
pi_multi.to_excel(""index_as_str_openpyxl.xlsx"", engine=""openpyxl"", index=True)

pi_index.to_excel(""index_as_date_xlsxwriter.xlsx"", engine=""xlsxwriter"",  index=True)
pi_multi.to_excel(""index_as_str_xlsxwriter.xlsx"", engine=""xlsxwriter"", index=True)
```


### Issue Description

When exporting a Series/DataFrame to excel when the index contains a PeriodIndex the format of the output depends on the index being an Index or a MultiIndex.

When the PeriodIndex is in an Index, the output format in Excel is a date.
When the PeriodIndex is a level from a MultiIndex, the output format is a string.

### Expected Behavior

The expected behaviour is that the format of the period would not be dependent on it being in an Index or in a MultiIndex. Being either a string or a date in excel is both acceptable as long as it is consistent in both outputs.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.12.4
python-bits           : 64
OS                    : Linux
OS-release            : 6.1.100+
Version               : #1 SMP PREEMPT_DYNAMIC Sat Oct  5 14:28:44 UTC 2024
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : None
LOCALE                : C.UTF-8

pandas                : 2.2.3
numpy                 : 2.0.0
pytz                  : 2024.1
dateutil              : 2.9.0.post0
pip                   : 24.2
Cython                : None
sphinx                : None
IPython               : 8.25.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : None
lxml.etree            : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : 3.1.5
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : 16.1.0
pyreadstat            : None
pytest                : 8.2.2
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : 2.0.31
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : 3.2.0
zstandard             : None
tzdata                : 2024.1
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60099/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60099/timeline,,
2,https://api.github.com/repos/pandas-dev/pandas/issues/60098,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60098/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60098/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60098/events,https://github.com/pandas-dev/pandas/issues/60098,2611324568,I_kwDOAA0YD86bpaaY,60098,PERF: Slowdowns with .isin() on columns typed as np.uint64,"{'login': 'adrian17', 'id': 4729533, 'node_id': 'MDQ6VXNlcjQ3Mjk1MzM=', 'avatar_url': 'https://avatars.githubusercontent.com/u/4729533?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/adrian17', 'html_url': 'https://github.com/adrian17', 'followers_url': 'https://api.github.com/users/adrian17/followers', 'following_url': 'https://api.github.com/users/adrian17/following{/other_user}', 'gists_url': 'https://api.github.com/users/adrian17/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/adrian17/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/adrian17/subscriptions', 'organizations_url': 'https://api.github.com/users/adrian17/orgs', 'repos_url': 'https://api.github.com/users/adrian17/repos', 'events_url': 'https://api.github.com/users/adrian17/events{/privacy}', 'received_events_url': 'https://api.github.com/users/adrian17/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 8935311, 'node_id': 'MDU6TGFiZWw4OTM1MzEx', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Performance', 'name': 'Performance', 'color': 'a10c02', 'default': False, 'description': 'Memory or execution speed performance'}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-24T11:48:50Z,2024-10-24T11:53:21Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this issue exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this issue exists on the main branch of pandas.


### Reproducible Example

```py
import pandas as pd, numpy as np
data = pd.DataFrame({
    ""uints"": np.random.randint(10000, size=300000, dtype=np.uint64),
    ""ints"": np.random.randint(10000, size=300000, dtype=np.int64),
})

%timeit data[""ints""].isin([1, 2]) # 3ms
%timeit data[""ints""].isin(np.array([1, 2], dtype=np.int64)) # 3ms
%timeit data[""ints""].isin(np.array([1, 2], dtype=np.uint64)) # 5ms
%timeit data[""ints""].isin([np.int64(1), np.int64(2)]) # 3ms
%timeit data[""ints""].isin([np.uint64(1), np.uint64(2)]) # 5ms

%timeit data[""uints""].isin([1, 2]) # 14ms (!)
%timeit data[""uints""].isin(np.array([1, 2], dtype=np.int64)) # 5ms
%timeit data[""uints""].isin(np.array([1, 2], dtype=np.uint64)) # 3ms
%timeit data[""uints""].isin([np.int64(1), np.int64(2)])  # 17ms (!)
%timeit data[""uints""].isin([np.uint64(1), np.uint64(2)]) # 17ms (!)
```

The last line, with older numpy==1.26.4 (last version <2.0), is even worse: ~200ms.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.10.12
python-bits           : 64
OS                    : Linux
OS-release            : 6.5.0-27-generic
Version               : #28~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Fri Mar 15 10:51:06 UTC 2
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 2.2.3
numpy                 : 2.1.2

</details>


### Prior Performance

With pandas 1.4.4 and numpy 1.26.4, all the benchmarks above show 3-5ms (3ms on signedness match, 5ms on signedness mismatch). So despite updating numpy mitigating the worst 200ms regression, this still looks like a 5x performance regression on pandas side since 1.4.4.

I'm guessing the regression could be related to PR https://github.com/pandas-dev/pandas/pull/46693 , which happened on the 1.5.0 release.",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60098/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60098/timeline,,
3,https://api.github.com/repos/pandas-dev/pandas/issues/60097,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60097/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60097/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60097/events,https://github.com/pandas-dev/pandas/pull/60097,2610563493,PR_kwDOAA0YD85_t_Mu,60097,[TST] Parse arrow_dtype as datetime index,"{'login': 'MCRE-BE', 'id': 99316631, 'node_id': 'U_kgDOBetzlw', 'avatar_url': 'https://avatars.githubusercontent.com/u/99316631?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/MCRE-BE', 'html_url': 'https://github.com/MCRE-BE', 'followers_url': 'https://api.github.com/users/MCRE-BE/followers', 'following_url': 'https://api.github.com/users/MCRE-BE/following{/other_user}', 'gists_url': 'https://api.github.com/users/MCRE-BE/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/MCRE-BE/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/MCRE-BE/subscriptions', 'organizations_url': 'https://api.github.com/users/MCRE-BE/orgs', 'repos_url': 'https://api.github.com/users/MCRE-BE/repos', 'events_url': 'https://api.github.com/users/MCRE-BE/events{/privacy}', 'received_events_url': 'https://api.github.com/users/MCRE-BE/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,1,2024-10-24T06:04:19Z,2024-10-24T06:06:39Z,,NONE,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60097', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60097', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60097.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60097.patch', 'merged_at': None}","- [X] closes #57930(Replace with the GitHub issue number)
- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60097/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60097/timeline,,
4,https://api.github.com/repos/pandas-dev/pandas/issues/60092,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60092/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60092/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60092/events,https://github.com/pandas-dev/pandas/issues/60092,2609966330,I_kwDOAA0YD86bkOz6,60092,BUG: select_dtypes does not work properly with numpy.ndarray,"{'login': 'fjossandon', 'id': 3794302, 'node_id': 'MDQ6VXNlcjM3OTQzMDI=', 'avatar_url': 'https://avatars.githubusercontent.com/u/3794302?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/fjossandon', 'html_url': 'https://github.com/fjossandon', 'followers_url': 'https://api.github.com/users/fjossandon/followers', 'following_url': 'https://api.github.com/users/fjossandon/following{/other_user}', 'gists_url': 'https://api.github.com/users/fjossandon/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/fjossandon/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/fjossandon/subscriptions', 'organizations_url': 'https://api.github.com/users/fjossandon/orgs', 'repos_url': 'https://api.github.com/users/fjossandon/repos', 'events_url': 'https://api.github.com/users/fjossandon/events{/privacy}', 'received_events_url': 'https://api.github.com/users/fjossandon/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-23T22:30:41Z,2024-10-23T22:32:18Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd
import numpy as np

table_df = pd.DataFrame({""id"": [1, 2, 3], ""dest_id"": [""var-foo-1"", ""var-foo-2"", ""baz-taz-1""], ""arr_col"": [np.array([1, 2]), np.array([3, 4]), np.array([4, 5])]})

print(type(table_df[""dest_id""][0]), type(table_df[""arr_col""][0]))

print(table_df.select_dtypes(include=[np.ndarray]).columns)
```


### Issue Description

I work with several dataframes, which occasionally have array columns. I was using `select_dtypes` to search for those columns containing Array type to manipulate them, but the function also returns the string columns, and my code crashes when it tries to apply the array function to the string column.

I was working with pandas 2.2.2 / numpy 1.26.2 when this happened, but I made a new environment and upgraded to the latest versions and it still happened.

### Expected Behavior

This is the current output:
```
>>> print(type(table_df[""dest_id""][0]), type(table_df[""arr_col""][0]))
<class 'str'> <class 'numpy.ndarray'>
>>> 
>>> print(table_df.select_dtypes(include=[np.ndarray]).columns)
Index(['dest_id', 'arr_col'], dtype='object')
```
I would expect that only `arr_col` is returned with select_dtypes when using `include=[np.ndarray]`.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 68d9dcab5b543adb3bfe5b83563c61a9b8afae77
python                : 3.11.6
python-bits           : 64
OS                    : Linux
OS-release            : 6.5.0-44-generic
Version               : #44-Ubuntu SMP PREEMPT_DYNAMIC Fri Jun  7 15:10:09 UTC 2024
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 3.0.0.dev0+1580.g68d9dcab5b
numpy                 : 2.1.2
dateutil              : 2.9.0.post0
pip                   : 23.2
Cython                : None
sphinx                : None
IPython               : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : None
lxml.etree            : 5.2.2
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
psycopg2              : None
pymysql               : None
pyarrow               : None
pyreadstat            : None
pytest                : None
python-calamine       : None
pytz                  : 2024.1
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.1
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60092/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60092/timeline,,
5,https://api.github.com/repos/pandas-dev/pandas/issues/60091,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60091/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60091/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60091/events,https://github.com/pandas-dev/pandas/issues/60091,2609739687,I_kwDOAA0YD86bjXen,60091,BUG: Merging on two non-monotonic `np.intc` arrays fails,"{'login': 'tehunter', 'id': 7980666, 'node_id': 'MDQ6VXNlcjc5ODA2NjY=', 'avatar_url': 'https://avatars.githubusercontent.com/u/7980666?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/tehunter', 'html_url': 'https://github.com/tehunter', 'followers_url': 'https://api.github.com/users/tehunter/followers', 'following_url': 'https://api.github.com/users/tehunter/following{/other_user}', 'gists_url': 'https://api.github.com/users/tehunter/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/tehunter/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/tehunter/subscriptions', 'organizations_url': 'https://api.github.com/users/tehunter/orgs', 'repos_url': 'https://api.github.com/users/tehunter/repos', 'events_url': 'https://api.github.com/users/tehunter/events{/privacy}', 'received_events_url': 'https://api.github.com/users/tehunter/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-23T20:14:20Z,2024-10-23T20:14:20Z,,CONTRIBUTOR,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    ""join_key"": pd.Series([0, 2, 1], dtype=np.intc)
})
df_details = pd.DataFrame({
    ""join_key"": pd.Series([0, 1, 2], dtype=np.intc),
    ""value"": [""a"", ""b"", ""c""]
})

merged = pd.merge(df, df_details, on=""join_key"", how=""left"")
```


### Issue Description

When merging on two `np.intc` arrays (where at least one is non-monotonic), pandas throws a ""Buffer dtype mismatch"" error. It only seems to happen when both arrays are `np.intc` type. I encountered this issue because that is the dtype returned from `pd.DatetimeIndex.weekday`.

```
Traceback (most recent call last):
  File ""merge_bug_test.py"", line 26, in <module>
    merged_1 = pd.merge(df, df_details, on=""join_key"", how=""left"")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 184, in merge
    return op.get_result(copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 886, in get_result
    join_index, left_indexer, right_indexer = self._get_join_info()
                                              ^^^^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 1151, in _get_join_info
    (left_indexer, right_indexer) = self._get_join_indexers()
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 1125, in _get_join_indexers
    return get_join_indexers(
           ^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 1759, in get_join_indexers
    lidx, ridx = get_join_indexers_non_unique(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 1793, in get_join_indexers_non_unique
    lkey, rkey, count = _factorize_keys(left, right, sort=sort)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""path\to\env\Lib\site-packages\pandas\core\reshape\merge.py"", line 2561, in _factorize_keys
    llab = rizer.factorize(lk)  # type: ignore[arg-type]
           ^^^^^^^^^^^^^^^^^^^
  File ""pandas\\_libs\\hashtable_class_helper.pxi"", line 3045, in pandas._libs.hashtable.Int64Factorizer.factorize
ValueError: Buffer dtype mismatch, expected 'const int64_t' but got 'int'
```

It seems this issue was raised in #52451, the solution that was implemented involves checking `if np.intc is not np.int32`. This check returns True, meaning that `np.intc` is mapped to `Int64Factorizer`. It appears that this check no longer works as intended, or it is not robust enough.

A similar issue is raised in #58713 for `uintc`. In the proposed solution (#58727), it was suggested to use `.itemsize` as a more robust check. I think that suggestion might get to the root cause, as my `np.intc(0).itemsize` is 4, so `np.intc` should be mapped to `Int32Factorizer`



### Expected Behavior

Merging should succeed if dtypes for both keys are the same.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.11.5
python-bits           : 64
OS                    : Windows
OS-release            : 10
Version               : ...
machine               : AMD64
processor             : Intel64 Family 6 ...
byteorder             : little
LC_ALL                : None
LANG                  : None
LOCALE                : English_United States.1252

pandas                : 2.2.3
numpy                 : 2.0.2
pytz                  : 2024.2
dateutil              : 2.9.0.post0
pip                   : None
Cython                : None
sphinx                : None
IPython               : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : 1.4.0
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.9.0
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.4
lxml.etree            : None
matplotlib            : None
numba                 : 0.60.0
numexpr               : 2.10.1
odfpy                 : None
openpyxl              : 3.1.5
pandas_gbq            : None
psycopg2              : 2.9.9
pymysql               : None
pyarrow               : 17.0.0
pyreadstat            : 1.2.7
pytest                : None
python-calamine       : None
pyxlsb                : 1.0.10
s3fs                  : 2024.9.0
scipy                 : None
sqlalchemy            : 2.0.35
tables                : None
tabulate              : 0.9.0
xarray                : None
xlrd                  : 2.0.1
xlsxwriter            : 3.2.0
zstandard             : None
tzdata                : 2024.2
qtpy                  : 2.4.1
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60091/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60091/timeline,,
6,https://api.github.com/repos/pandas-dev/pandas/issues/60090,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60090/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60090/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60090/events,https://github.com/pandas-dev/pandas/issues/60090,2609664670,I_kwDOAA0YD86bjFKe,60090,error code deduction ,"{'login': 'abigalegeathers', 'id': 185436704, 'node_id': 'U_kgDOCw2KIA', 'avatar_url': 'https://avatars.githubusercontent.com/u/185436704?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/abigalegeathers', 'html_url': 'https://github.com/abigalegeathers', 'followers_url': 'https://api.github.com/users/abigalegeathers/followers', 'following_url': 'https://api.github.com/users/abigalegeathers/following{/other_user}', 'gists_url': 'https://api.github.com/users/abigalegeathers/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/abigalegeathers/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/abigalegeathers/subscriptions', 'organizations_url': 'https://api.github.com/users/abigalegeathers/orgs', 'repos_url': 'https://api.github.com/users/abigalegeathers/repos', 'events_url': 'https://api.github.com/users/abigalegeathers/events{/privacy}', 'received_events_url': 'https://api.github.com/users/abigalegeathers/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,1,2024-10-23T19:31:28Z,2024-10-23T19:32:41Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
<details>

Replace this line with the output of pd.show_versions()

<#._c++c_.#> lag report restore description 
=
Open source code
```


### Issue Description

simplified error deduction code 

### Expected Behavior

<details>

Replace this line with the output of pd.show_versions()

</details>
`zonkers.com
`


### Installed Versions

<details>

Replace this line with the output of pd.show_versions()

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60090/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60090/timeline,,
7,https://api.github.com/repos/pandas-dev/pandas/issues/60089,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60089/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60089/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60089/events,https://github.com/pandas-dev/pandas/pull/60089,2609317219,PR_kwDOAA0YD85_ptgS,60089,relax meson/meson-python requirements,"{'login': 'isuruf', 'id': 5234427, 'node_id': 'MDQ6VXNlcjUyMzQ0Mjc=', 'avatar_url': 'https://avatars.githubusercontent.com/u/5234427?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/isuruf', 'html_url': 'https://github.com/isuruf', 'followers_url': 'https://api.github.com/users/isuruf/followers', 'following_url': 'https://api.github.com/users/isuruf/following{/other_user}', 'gists_url': 'https://api.github.com/users/isuruf/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/isuruf/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/isuruf/subscriptions', 'organizations_url': 'https://api.github.com/users/isuruf/orgs', 'repos_url': 'https://api.github.com/users/isuruf/repos', 'events_url': 'https://api.github.com/users/isuruf/events{/privacy}', 'received_events_url': 'https://api.github.com/users/isuruf/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 129350, 'node_id': 'MDU6TGFiZWwxMjkzNTA=', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Build', 'name': 'Build', 'color': '75507B', 'default': False, 'description': 'Library building on various platforms'}, {'id': 6956692121, 'node_id': 'LA_kwDOAA0YD88AAAABnqaymQ', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Python%203.13', 'name': 'Python 3.13', 'color': 'fef2c0', 'default': False, 'description': ''}]",open,False,,[],,0,2024-10-23T17:19:58Z,2024-10-24T12:06:58Z,,NONE,,True,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60089', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60089', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60089.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60089.patch', 'merged_at': None}","This makes bugfixes from later meson/meson-python fixes available to build pandas. For eg: python 3.13t support in meson, needs an up-to-date version of meson.

- [ ] closes #xxxx (Replace xxxx with the GitHub issue number)
- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.

cc @rgommers ",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60089/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60089/timeline,,
8,https://api.github.com/repos/pandas-dev/pandas/issues/60088,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60088/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60088/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60088/events,https://github.com/pandas-dev/pandas/issues/60088,2608824028,I_kwDOAA0YD86bf37c,60088,BUG: Datatypes not preserved on pd.read_excel,"{'login': 'vignesh14052002', 'id': 63579905, 'node_id': 'MDQ6VXNlcjYzNTc5OTA1', 'avatar_url': 'https://avatars.githubusercontent.com/u/63579905?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/vignesh14052002', 'html_url': 'https://github.com/vignesh14052002', 'followers_url': 'https://api.github.com/users/vignesh14052002/followers', 'following_url': 'https://api.github.com/users/vignesh14052002/following{/other_user}', 'gists_url': 'https://api.github.com/users/vignesh14052002/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/vignesh14052002/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/vignesh14052002/subscriptions', 'organizations_url': 'https://api.github.com/users/vignesh14052002/orgs', 'repos_url': 'https://api.github.com/users/vignesh14052002/repos', 'events_url': 'https://api.github.com/users/vignesh14052002/events{/privacy}', 'received_events_url': 'https://api.github.com/users/vignesh14052002/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 49254273, 'node_id': 'MDU6TGFiZWw0OTI1NDI3Mw==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/IO%20Excel', 'name': 'IO Excel', 'color': 'bfe5bf', 'default': False, 'description': 'read_excel, to_excel'}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-23T14:28:57Z,2024-10-23T15:08:27Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd
pd.read_excel(""./preserve_data.xlsx"")
```


### Issue Description

Input data
![image](https://github.com/user-attachments/assets/e8d9a588-a49f-4007-bb41-c262431d9d36)

## Datatype is preserved, but values are modified
TRUE -> 1
![image](https://github.com/user-attachments/assets/753f38bd-a987-4565-81b1-51a2033ea3b5)

## values are modified, even if i read as string
TRUE <-> 1
![image](https://github.com/user-attachments/assets/c7d2e216-327b-4440-a6ed-090a455a4342)

additionally, I want TRUE in uppercase, if it is changed to True, i can't find difference if user has 'True in a cell


### Expected Behavior

There should be a way to preserve values and datatypes as it is

### Installed Versions

<details>


INSTALLED VERSIONS
------------------
commit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140
python                : 3.11.3.final.0
python-bits           : 64
OS                    : Windows
OS-release            : 10
Version               : 10.0.19045
machine               : AMD64
processor             : Intel64 Family 6 Model 142 Stepping 12, GenuineIntel
byteorder             : little
LC_ALL                : None
LANG                  : None
LOCALE                : English_India.1252

pandas                : 2.2.2
numpy                 : 1.26.2
pytz                  : 2024.1
dateutil              : 2.8.2
setuptools            : 69.0.2
pip                   : 23.1.2
Cython                : None
pytest                : None
hypothesis            : None
sphinx                : None
blosc                 : None
feather               : None
xlsxwriter            : None
lxml.etree            : None
html5lib              : None
pymysql               : None
psycopg2              : None
jinja2                : 3.1.4
IPython               : 8.18.1
pandas_datareader     : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.9.0
gcsfs                 : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : 3.1.5
pandas_gbq            : None
pyarrow               : None
pyreadstat            : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.12.0
sqlalchemy            : 2.0.23
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
zstandard             : None
tzdata                : 2024.1
qtpy                  : None
pyqt5                 : None


</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60088/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60088/timeline,,
9,https://api.github.com/repos/pandas-dev/pandas/issues/60087,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60087/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60087/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60087/events,https://github.com/pandas-dev/pandas/issues/60087,2608643168,I_kwDOAA0YD86bfLxg,60087,QST: Why is it necessary to not allow `include_groups=True` in future versions for groupby(...).apply(...) operations?,"{'login': 'mattmills49', 'id': 6332852, 'node_id': 'MDQ6VXNlcjYzMzI4NTI=', 'avatar_url': 'https://avatars.githubusercontent.com/u/6332852?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/mattmills49', 'html_url': 'https://github.com/mattmills49', 'followers_url': 'https://api.github.com/users/mattmills49/followers', 'following_url': 'https://api.github.com/users/mattmills49/following{/other_user}', 'gists_url': 'https://api.github.com/users/mattmills49/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/mattmills49/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/mattmills49/subscriptions', 'organizations_url': 'https://api.github.com/users/mattmills49/orgs', 'repos_url': 'https://api.github.com/users/mattmills49/repos', 'events_url': 'https://api.github.com/users/mattmills49/events{/privacy}', 'received_events_url': 'https://api.github.com/users/mattmills49/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 34444536, 'node_id': 'MDU6TGFiZWwzNDQ0NDUzNg==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Usage%20Question', 'name': 'Usage Question', 'color': '0052cc', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,1,2024-10-23T13:34:28Z,2024-10-23T14:56:36Z,,NONE,,,,"### Research

- [X] I have searched the [[pandas] tag](https://stackoverflow.com/questions/tagged/pandas) on StackOverflow for similar questions.

- [X] I have asked my usage related question on [StackOverflow](https://stackoverflow.com).


### Link to question on StackOverflow

https://stackoverflow.com/questions/77969964/deprecation-warning-with-groupby-apply

### Question about pandas

I find it strange that in the docs it is stated that the include_groups option won't allow True as an option starting in 3.0. I use `groupby(...).apply(...)` all the time working with tabular data and fully expect the group by columns to be included in the result. I feel like I have to be mis-understanding something about the warning because I can't fathom not having to select all the columns I need from the group by every time I use the operation. This is a very common data pattern I use:

```python
summarize_df = (
  df.
  groupby(['user_id']).
  apply(lambda df: pd.Series(dict(
    num_orders = len(df),
    aov = np.mean(df['amount']),
    first_order = np.min(df['order_date'])
  ))).
  reset_index()
)
```

Which will give me another dataframe that I can use and has `user_id` in the column. The stack overflow question I linked seems to suggest the only way to get the user_id as a column in the future will be to 1.) add it to the index first or 2.) selecting the group by column after the apply call, but I would have to copy and re-select every column I created in the apply statement as well. The documentation for DataFrameGroupBy.apply doesn't make it clear how you'd keep the group by column. 

Is this the intended behavior of this change? Is it assumed every user who is doing what I am doing is using `agg` instead of `apply`? Thanks!",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60087/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60087/timeline,,
10,https://api.github.com/repos/pandas-dev/pandas/issues/60086,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60086/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60086/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60086/events,https://github.com/pandas-dev/pandas/issues/60086,2608361835,I_kwDOAA0YD86beHFr,60086,BUG: DataFrame Dict not callabe,"{'login': 'kellykayaks', 'id': 16313431, 'node_id': 'MDQ6VXNlcjE2MzEzNDMx', 'avatar_url': 'https://avatars.githubusercontent.com/u/16313431?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/kellykayaks', 'html_url': 'https://github.com/kellykayaks', 'followers_url': 'https://api.github.com/users/kellykayaks/followers', 'following_url': 'https://api.github.com/users/kellykayaks/following{/other_user}', 'gists_url': 'https://api.github.com/users/kellykayaks/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/kellykayaks/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/kellykayaks/subscriptions', 'organizations_url': 'https://api.github.com/users/kellykayaks/orgs', 'repos_url': 'https://api.github.com/users/kellykayaks/repos', 'events_url': 'https://api.github.com/users/kellykayaks/events{/privacy}', 'received_events_url': 'https://api.github.com/users/kellykayaks/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-23T12:07:53Z,2024-10-23T12:07:53Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd

d = {'col1': [1,3], 'col2': [4,5]}
df = pd.DataFrame(data=d)
print(df)


  File ~\anaconda3\Lib\site-packages\spyder_kernels\py3compat.py:356 in compat_exec
    exec(code, globals, locals)

  File c:\dennis\savedennis\f\pythonstocks\code\untitled3.py:10
    df = pd.DataFrame(data=d)

TypeError: 'dict' object is not callable
```


### Issue Description

Everything worked fine until a couple of days ago

### Expected Behavior

This code is exactly copied from your examples

### Installed Versions

<details>
INSTALLED VERSIONS
------------------
commit              : a671b5a8bf5dd13fb19f0e88edc679bc9e15c673
python              : 3.11.7.final.0
python-bits         : 64
OS                  : Windows
OS-release          : 10
Version             : 10.0.22631
machine             : AMD64
processor           : Intel64 Family 6 Model 140 Stepping 2, GenuineIntel
byteorder           : little
LC_ALL              : None
LANG                : en
LOCALE              : English_United States.1252

pandas              : 2.1.4
numpy               : 1.26.4
pytz                : 2023.3.post1
dateutil            : 2.8.2
setuptools          : 68.2.2
pip                 : 23.3.1
Cython              : None
pytest              : 7.4.0
hypothesis          : None
sphinx              : 5.0.2
blosc               : None
feather             : None
xlsxwriter          : None
lxml.etree          : 4.9.3
html5lib            : 1.1
pymysql             : None
psycopg2            : None
jinja2              : 3.1.3
IPython             : 8.20.0
pandas_datareader   : None
bs4                 : 4.12.2
bottleneck          : 1.3.7
dataframe-api-compat: None
fastparquet         : None
fsspec              : 2023.10.0
gcsfs               : None
matplotlib          : 3.8.0
numba               : 0.59.0
numexpr             : 2.8.7
odfpy               : None
openpyxl            : 3.0.10
pandas_gbq          : None
pyarrow             : 14.0.2
pyreadstat          : None
pyxlsb              : None
s3fs                : 2023.10.0
scipy               : 1.11.4
sqlalchemy          : 2.0.25
tables              : 3.9.2
tabulate            : 0.9.0
xarray              : 2023.6.0
xlrd                : None
zstandard           : 0.19.0
tzdata              : 2023.3
qtpy                : 2.4.1
pyqt5               : None
Replace this line with the output of pd.show_versions()

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60086/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60086/timeline,,
11,https://api.github.com/repos/pandas-dev/pandas/issues/60085,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60085/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60085/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60085/events,https://github.com/pandas-dev/pandas/issues/60085,2606891280,I_kwDOAA0YD86bYgEQ,60085,BUG: Type Annotation Inconsistency in real_sql_* Functions ,"{'login': 'FakeNameSE', 'id': 13919930, 'node_id': 'MDQ6VXNlcjEzOTE5OTMw', 'avatar_url': 'https://avatars.githubusercontent.com/u/13919930?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/FakeNameSE', 'html_url': 'https://github.com/FakeNameSE', 'followers_url': 'https://api.github.com/users/FakeNameSE/followers', 'following_url': 'https://api.github.com/users/FakeNameSE/following{/other_user}', 'gists_url': 'https://api.github.com/users/FakeNameSE/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/FakeNameSE/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/FakeNameSE/subscriptions', 'organizations_url': 'https://api.github.com/users/FakeNameSE/orgs', 'repos_url': 'https://api.github.com/users/FakeNameSE/repos', 'events_url': 'https://api.github.com/users/FakeNameSE/events{/privacy}', 'received_events_url': 'https://api.github.com/users/FakeNameSE/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-23T01:34:05Z,2024-10-23T01:35:06Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd 
import sqlite3


date_params = {""date_col"": {""utc"": True}}

with sqlite3.connect(""blah"") as con:
    # Fails type check.
    df = pd.read_sql_query(""SELECT * FROM tablename"", con, parse_dates=date_params)
    print(df)
```


### Issue Description

The pandas type annotations for the `parse_dates` argument in `read_sql_table()` and `read_sql_query()` is overly restrictive. It incorrectly causes type checkers to complain when using the `parse_dates` argument to pass keyword arguments to `to_datetime()` as documented [here](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_sql_query.html).

To solve this problem, the annotated type for `parse_date` just needs to be switched from `parse_dates: list[str] | dict[str, str] | None` to `list[str] | dict[str, str] | dict[str, dict[str, Any]] | None`.

This problem is not always visible because the corresponding `pandas-stubs` already does this. The inconsistency appears however in some type checkers when additional stubs are not available or configured though.

To illustrate, take the provided (valid) example and run `pyright` on it (with no arguments). It will output the following.

```
(bug_venv)$ pyright example.py
/home/user/Code/pandas_bug/example.py
/home/user/Code/pandas_bug/example.py:8:10 - error: No overloads for ""read_sql_query"" match the provided arguments (reportCallIssue)
/home/user/Code/pandas_bug/example.py:8:72 - error: Argument of type ""dict[str, dict[str, bool]]"" cannot be assigned to parameter ""parse_dates"" of type ""list[str] |dict[str, str] | None"" in function ""read_sql_query""
Type ""dict[str, dict[str, bool]]"" is not assignable to type ""list[str] | dict[str, str] | None""
""dict[str, dict[str, bool]]"" is not assignable to ""list[str]""
""dict[str, dict[str, bool]]"" is not assignable to ""dict[str, str]""
Type parameter ""_VT@dict"" is invariant, but ""dict[str, bool]"" is not the same as ""str""
Consider switching from ""dict"" to ""Mapping"" which is covariant in the value type
""dict[str, dict[str, bool]]"" is not assignable to ""None"" (reportArgumentType)
2 errors, 0 warnings, 0 informations
```

I am more than happy to submit a pull request for this is desired, but thought it best to put in this issue first in case I am missing something.

### Expected Behavior

import pandas as pd 
import sqlite3


date_params = {""date_col"": {""utc"": True}}

with sqlite3.connect(""blah"") as con:
    # Type checks correctly
    df = pd.read_sql_query(""SELECT * FROM tablename"", con, parse_dates=date_params)
    print(df) 

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.12.6
python-bits           : 64
OS                    : Linux
OS-release            : 6.11.2-arch1-1
Version               : #1 SMP PREEMPT_DYNAMIC Fri, 04 Oct 2024 21:51:11 +0000
machine               : x86_64
processor             : 
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 2.2.3
numpy                 : 2.1.2
pytz                  : 2024.2
dateutil              : 2.9.0.post0
pip                   : 24.2
Cython                : None
sphinx                : None
IPython               : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : None
lxml.etree            : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : None
pyreadstat            : None
pytest                : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None
</details>",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60085/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60085/timeline,,
12,https://api.github.com/repos/pandas-dev/pandas/issues/60084,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60084/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60084/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60084/events,https://github.com/pandas-dev/pandas/issues/60084,2606527029,I_kwDOAA0YD86bXHI1,60084,BUG: arithmetic can break equality-hash invariant for Timestamp during DST transition,"{'login': 'Kxnr', 'id': 13527877, 'node_id': 'MDQ6VXNlcjEzNTI3ODc3', 'avatar_url': 'https://avatars.githubusercontent.com/u/13527877?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/Kxnr', 'html_url': 'https://github.com/Kxnr', 'followers_url': 'https://api.github.com/users/Kxnr/followers', 'following_url': 'https://api.github.com/users/Kxnr/following{/other_user}', 'gists_url': 'https://api.github.com/users/Kxnr/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/Kxnr/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/Kxnr/subscriptions', 'organizations_url': 'https://api.github.com/users/Kxnr/orgs', 'repos_url': 'https://api.github.com/users/Kxnr/repos', 'events_url': 'https://api.github.com/users/Kxnr/events{/privacy}', 'received_events_url': 'https://api.github.com/users/Kxnr/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1654197779, 'node_id': 'MDU6TGFiZWwxNjU0MTk3Nzc5', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/hashing', 'name': 'hashing', 'color': '6beae0', 'default': False, 'description': 'hash_pandas_object'}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}, {'id': 3877216987, 'node_id': 'LA_kwDOAA0YD87nGaLb', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Timestamp', 'name': 'Timestamp', 'color': '5DE3E8', 'default': False, 'description': 'pd.Timestamp and associated methods'}]",open,False,,[],,2,2024-10-22T21:13:08Z,2024-10-23T20:46:27Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd

# this is immediately following a DST transition
dt_str = ""2023-11-05 01:00-08:00""
tz_str = ""America/Los_Angeles""

ts1 = pd.Timestamp(dt_str, tz=tz_str)

# This is the shortest way I know of to reproduce--more complex math or `pd.date_range` can also
# create this behavior.
ts2 = ts1 + pd.Timedelta(hours=0)
                                                                                                                                                                                                                               
assert ts1 == ts2  # True
assert hash(ts1) == hash(ts2)  # False
```


### Issue Description

Datetime arithmetic on a `Timestamp` instance on a DST transition can create two `Timestamps` that compare equal but have different hash values. Inspecting the example, the cause seems to be that `ts1.fold == 0` and `ts2.fold == 1`, despite otherwise being equal and representing the same instant in time. This breaks the invariant documented in [`object.__hash__`](https://docs.python.org/3/reference/datamodel.html#object.__hash__):

> object.\_\_hash\_\_(self)
> ... The only required property is that objects which compare equal have the same hash value; ...

Converting to UTC or using `pytz`'s normalization as `ts.tz.normalize(ts)` both serve as workarounds for this issue.

### Expected Behavior

I expected `Timestamp` instances that compare equal to have the same hash value.

### Installed Versions

<details>
                                                                                                                                                                                                                                           
INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.12.6
python-bits           : 64
OS                    : Linux
OS-release            : 5.15.153.1-microsoft-standard-WSL2
Version               : #1 SMP Fri Mar 29 23:14:13 UTC 2024
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : C.UTF-8
LOCALE                : C.UTF-8
                                                                                                                                                                                                                                           
pandas                : 2.2.3
numpy                 : 2.1.2
pytz                  : 2024.2
dateutil              : 2.9.0.post0
pip                   : 24.1.2
Cython                : None
sphinx                : None
IPython               : 8.28.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : None
lxml.etree            : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : None
pyreadstat            : None
pytest                : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60084/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60084/timeline,,
13,https://api.github.com/repos/pandas-dev/pandas/issues/60082,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60082/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60082/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60082/events,https://github.com/pandas-dev/pandas/issues/60082,2605912993,I_kwDOAA0YD86bUxOh,60082,"BUG: reading long csv with high numeric values displays a ""mixed types"" message","{'login': 'MayeulC-ST', 'id': 152973282, 'node_id': 'U_kgDOCR4v4g', 'avatar_url': 'https://avatars.githubusercontent.com/u/152973282?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/MayeulC-ST', 'html_url': 'https://github.com/MayeulC-ST', 'followers_url': 'https://api.github.com/users/MayeulC-ST/followers', 'following_url': 'https://api.github.com/users/MayeulC-ST/following{/other_user}', 'gists_url': 'https://api.github.com/users/MayeulC-ST/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/MayeulC-ST/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/MayeulC-ST/subscriptions', 'organizations_url': 'https://api.github.com/users/MayeulC-ST/orgs', 'repos_url': 'https://api.github.com/users/MayeulC-ST/repos', 'events_url': 'https://api.github.com/users/MayeulC-ST/events{/privacy}', 'received_events_url': 'https://api.github.com/users/MayeulC-ST/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,2,2024-10-22T16:18:11Z,2024-10-23T10:00:59Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
# Load csv attached to this issue
import pandas as pd
df = pd.read_csv(""pandas-bug-reproducer.csv"", header=0, index_col=False)
```


### Issue Description

The `read_csv` command results in the following message (this is ipython output, but it also happens non-interactively)
```
<ipython-input-61-2957767dea3a>:1: DtypeWarning: Columns (7) have mixed types. Specify dtype option on import or set low_memory=False.
```

Column 7 is then imported as strings, not floats.

I can work around this by using the methods in the hint, but this smells like a bug, as if I remove **any** line in the CSV, the issue disappears. If I replace the last line by a copy-paste of the one before, the bug also goes away.

It is quite tricky to create a small reproducer, so I am attaching the file here.
Replacing all text with ""a"" and values with ""1"" kept the issue, while making the data anonymous and very compressible: 
[pandas-bug-reproducer.zip](https://github.com/user-attachments/files/17477355/pandas-bug-reproducer.zip)


### Expected Behavior

This message should not appear, and the data in column 7 should be imported as floating point values.

Moreover, changing the input csv by adding or removing random lines should not affect pandas's behavior.

### Installed Versions

<details>

<summary>First version I tried</summary>

INSTALLED VERSIONS
------------------
commit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140
python                : 3.10.4.final.0
python-bits           : 64
OS                    : Linux
OS-release            : 4.18.0-553.16.1.el8_10.x86_64
Version               : #1 SMP Thu Aug 1 04:16:12 EDT 2024
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 2.2.2
numpy                 : 1.26.4
pytz                  : 2024.1
dateutil              : 2.9.0.post0
setuptools            : 69.2.0
pip                   : 24.2
Cython                : 3.0.2
pytest                : 8.2.2
hypothesis            : None
sphinx                : 7.3.7
blosc                 : None
feather               : None
xlsxwriter            : 3.1.9
lxml.etree            : 4.9.3
html5lib              : None
pymysql               : 1.0.2
psycopg2              : None
jinja2                : 3.1.4
IPython               : 8.4.0
pandas_datareader     : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
bottleneck            : 1.4.0
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.3.1
gcsfs                 : None
matplotlib            : 3.7.3
numba                 : 0.60.0
numexpr               : 2.10.0
odfpy                 : None
openpyxl              : 3.1.2
pandas_gbq            : None
pyarrow               : 17.0.0
pyreadstat            : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.14.1
sqlalchemy            : 2.0.15
tables                : None
tabulate              : 0.9.0
xarray                : None
xlrd                  : 2.0.1
zstandard             : None
tzdata                : 2024.1
qtpy                  : None
pyqt5                 : None

</details>

<details>

<summary>Second version I tried</summary>


INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.12.2
python-bits           : 64
OS                    : Linux
OS-release            : 4.18.0-553.16.1.el8_10.x86_64
Version               : #1 SMP Thu Aug 1 04:16:12 EDT 2024
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 2.2.3
numpy                 : 2.1.2
pytz                  : 2024.2
dateutil              : 2.9.0.post0
pip                   : 24.0
Cython                : None
sphinx                : 8.1.3
IPython               : 8.28.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.4
lxml.etree            : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : None
pyreadstat            : None
pytest                : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60082/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60082/timeline,,
14,https://api.github.com/repos/pandas-dev/pandas/issues/60081,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60081/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60081/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60081/events,https://github.com/pandas-dev/pandas/pull/60081,2604164047,PR_kwDOAA0YD85_ZjuP,60081,"BUG: fix DataFrame(data=[None, 1], dtype='timedelta64[ns]') raising ValueError","{'login': 'yuanx749', 'id': 47032563, 'node_id': 'MDQ6VXNlcjQ3MDMyNTYz', 'avatar_url': 'https://avatars.githubusercontent.com/u/47032563?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/yuanx749', 'html_url': 'https://github.com/yuanx749', 'followers_url': 'https://api.github.com/users/yuanx749/followers', 'following_url': 'https://api.github.com/users/yuanx749/following{/other_user}', 'gists_url': 'https://api.github.com/users/yuanx749/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/yuanx749/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/yuanx749/subscriptions', 'organizations_url': 'https://api.github.com/users/yuanx749/orgs', 'repos_url': 'https://api.github.com/users/yuanx749/repos', 'events_url': 'https://api.github.com/users/yuanx749/events{/privacy}', 'received_events_url': 'https://api.github.com/users/yuanx749/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,1,2024-10-22T03:56:45Z,2024-10-22T04:18:50Z,,CONTRIBUTOR,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60081', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60081', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60081.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60081.patch', 'merged_at': None}","- [x] closes #60064(Replace xxxx with the GitHub issue number)
- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60081/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60081/timeline,,
15,https://api.github.com/repos/pandas-dev/pandas/issues/60080,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60080/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60080/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60080/events,https://github.com/pandas-dev/pandas/issues/60080,2603612432,I_kwDOAA0YD86bL_kQ,60080,BUG: Timezone upon DatetimeIndex union is changed to UTC,"{'login': 'alippai', 'id': 240729, 'node_id': 'MDQ6VXNlcjI0MDcyOQ==', 'avatar_url': 'https://avatars.githubusercontent.com/u/240729?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/alippai', 'html_url': 'https://github.com/alippai', 'followers_url': 'https://api.github.com/users/alippai/followers', 'following_url': 'https://api.github.com/users/alippai/following{/other_user}', 'gists_url': 'https://api.github.com/users/alippai/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/alippai/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/alippai/subscriptions', 'organizations_url': 'https://api.github.com/users/alippai/orgs', 'repos_url': 'https://api.github.com/users/alippai/repos', 'events_url': 'https://api.github.com/users/alippai/events{/privacy}', 'received_events_url': 'https://api.github.com/users/alippai/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-21T20:39:27Z,2024-10-21T20:39:27Z,,CONTRIBUTOR,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd

i1 = pd.DatetimeIndex(['2020-01-01 10:00:00+05:00']).astype('datetime64[us, UTC+05:00]')
i2 = pd.DatetimeIndex(['2020-01-01 10:00:00+05:00']).astype('datetime64[ns, UTC+05:00]')
i1.union(i2) # returns DatetimeIndex(['2020-01-01 05:00:00+00:00'], dtype='datetime64[ns, UTC]', freq=None)
```


### Issue Description

@lukemanley @mroeschke looks like test case from https://github.com/pandas-dev/pandas/issues/55238 could be extended to different timezones, currently if taking the union of two `DatetimeIndex` with the same timezone, but different `unit`, then it results in an UTC timezone.

### Expected Behavior

The result should be the higher resolution unit and the original timezone

### Installed Versions

<details>
python : 3.10.14
pandas : 2.2.2
</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60080/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60080/timeline,,
16,https://api.github.com/repos/pandas-dev/pandas/issues/60079,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60079/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60079/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60079/events,https://github.com/pandas-dev/pandas/issues/60079,2602399908,I_kwDOAA0YD86bHXik,60079,BUG: Relative timedelta isn't plotted like datetime,"{'login': 'maoding', 'id': 21102285, 'node_id': 'MDQ6VXNlcjIxMTAyMjg1', 'avatar_url': 'https://avatars.githubusercontent.com/u/21102285?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/maoding', 'html_url': 'https://github.com/maoding', 'followers_url': 'https://api.github.com/users/maoding/followers', 'following_url': 'https://api.github.com/users/maoding/following{/other_user}', 'gists_url': 'https://api.github.com/users/maoding/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/maoding/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/maoding/subscriptions', 'organizations_url': 'https://api.github.com/users/maoding/orgs', 'repos_url': 'https://api.github.com/users/maoding/repos', 'events_url': 'https://api.github.com/users/maoding/events{/privacy}', 'received_events_url': 'https://api.github.com/users/maoding/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-21T12:28:32Z,2024-10-21T13:17:41Z,,NONE,,,,"### Pandas version checks

- [x] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd

num_rows = 10
data = {
    ""datetime"": [pd.to_datetime(""now"") + pd.Timedelta(hours=i) * i for i in range(num_rows)],
    ""values"": (i for i in range(10)),
       }
df = pd.DataFrame(data)
df[""time""] = df.datetime.diff().fillna(pd.Timedelta(0)).cumsum()

# plot with datetime index
df.set_index(""datetime"")[""values""].plot(style="".-"")

# plot with timedelta index
df.set_index(""time"")[""values""].plot(style="".-"")
```


### Issue Description

Plotting the same data with a datetime index or timedelta index yield different plot results. In the first case equispaced x-ticks are created whereas in the latter the time relation isn't considered.

![image](https://github.com/user-attachments/assets/e9f5b39f-9a8e-44d9-8d93-95628895dcab)


![image](https://github.com/user-attachments/assets/df81d240-396b-4a59-aa8f-345ba1fa139e)


### Expected Behavior

I expected the same plot simply with different x-axis labels.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140
python                : 3.12.5.final.0
python-bits           : 64
OS                    : Windows
OS-release            : 11
Version               : 10.0.22621
machine               : AMD64
processor             : Intel64 Family 6 Model 140 Stepping 1, GenuineIntel
byteorder             : little
LC_ALL                : None
LANG                  : None
LOCALE                : de_DE.cp1252

pandas                : 2.2.2
numpy                 : 1.26.4
pytz                  : 2024.1
dateutil              : 2.9.0.post0
setuptools            : 75.1.0
pip                   : 24.2
Cython                : None
pytest                : None
hypothesis            : None
sphinx                : None
blosc                 : None
feather               : None
xlsxwriter            : None
lxml.etree            : 5.2.1
html5lib              : None
pymysql               : None
psycopg2              : None
jinja2                : 3.1.4
IPython               : 8.27.0
pandas_datareader     : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
bottleneck            : 1.3.7
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
gcsfs                 : None
matplotlib            : 3.9.2
numba                 : 0.60.0
numexpr               : 2.8.7
odfpy                 : None
openpyxl              : 3.1.5
pandas_gbq            : None
pyarrow               : None
pyreadstat            : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.13.1
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
zstandard             : None
tzdata                : 2023.3
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60079/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60079/timeline,,
17,https://api.github.com/repos/pandas-dev/pandas/issues/60078,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60078/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60078/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60078/events,https://github.com/pandas-dev/pandas/issues/60078,2601267594,I_kwDOAA0YD86bDDGK,60078,BUG: timedeltas.pyx.c varies between builds,"{'login': 'bmwiedemann', 'id': 637990, 'node_id': 'MDQ6VXNlcjYzNzk5MA==', 'avatar_url': 'https://avatars.githubusercontent.com/u/637990?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/bmwiedemann', 'html_url': 'https://github.com/bmwiedemann', 'followers_url': 'https://api.github.com/users/bmwiedemann/followers', 'following_url': 'https://api.github.com/users/bmwiedemann/following{/other_user}', 'gists_url': 'https://api.github.com/users/bmwiedemann/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/bmwiedemann/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/bmwiedemann/subscriptions', 'organizations_url': 'https://api.github.com/users/bmwiedemann/orgs', 'repos_url': 'https://api.github.com/users/bmwiedemann/repos', 'events_url': 'https://api.github.com/users/bmwiedemann/events{/privacy}', 'received_events_url': 'https://api.github.com/users/bmwiedemann/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-21T04:14:59Z,2024-10-21T04:14:59Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
I extracted this reproducer:


cd ~/rpmbuild/BUILD/pandas-2.2.2 && for i in $(seq 30) ; do setarch -R cython -3 ./pandas/../pandas/../pandas/../pandas/_libs/tslibs/timedeltas.pyx -o pyx.c ; m=$(md5sum pyx.c|cut -c1-20); cp -a pyx.c pyx.c.$m ; echo $m; done | sort | uniq -c
```


### Issue Description

While working on [reproducible builds](https://reproducible-builds.org/) for [openSUSE](https://en.opensuse.org/openSUSE:Reproducible_Builds) (sponsored by the NLnet NGI0 fund), I found that
our python-pandas 2.2.2 and 2.2.3 (also seen in pandas-2.0.2, possibly also earlier versions) vary
in the generated `pandas/_libs/tslibs/timedeltas.pyx.c` file.

The reproducer only produces 30 times the same hash with the `setarch -R` to disable ASLR.
Without it, you get a random chance for two different results.
The probability also seems to depend on the length of the path string.

```
      5 7653942dcdd2ad6fd8a5
     25 af0a5fefad3a417a7420
```

Using
```bash
diff -u9 pyx.c.[7a]*
```
the diff of those files is
```diff
--- pyx.c.7653942dcdd2ad6fd8a5 2024-10-21 03:51:25.407942993 +0000
+++ pyx.c.af0a5fefad3a417a7420 2024-10-21 03:52:02.744128704 +0000
@@ -45871,19 +45871,19 @@
 
 static PyObject *__pyx_pf_6pandas_5_libs_6tslibs_10timedeltas_9Timedelta___new__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_value, PyObject *__pyx_v_unit, PyObject *__pyx_v_kwargs) {
   PyObject *__pyx_v_unsupported_kwargs = NULL;
   PyObject *__pyx_v_seconds = NULL;
   PyObject *__pyx_v_ns = NULL;
   PyObject *__pyx_v_us = NULL;
   PyObject *__pyx_v_ms = NULL;
   PyObject *__pyx_v_err = NULL;
   PyObject *__pyx_v_msg = NULL;
-  npy_timedelta __pyx_v_new_value;
+  __pyx_t_5numpy_int64_t __pyx_v_new_value;
   NPY_DATETIMEUNIT __pyx_v_reso;
   NPY_DATETIMEUNIT __pyx_v_new_reso;
   PyObject *__pyx_8genexpr2__pyx_v_key = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   Py_ssize_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
```

### Expected Behavior

Build results should be deterministic.

### Installed Versions

openSUSE Tumbleweed 20241018
Cython-3.0.11",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60078/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60078/timeline,,
18,https://api.github.com/repos/pandas-dev/pandas/issues/60077,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60077/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60077/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60077/events,https://github.com/pandas-dev/pandas/pull/60077,2600862888,PR_kwDOAA0YD85_PXa9,60077,FIX: Resolve KeyError with LaTeX headers in to_latex method,"{'login': 'timapage', 'id': 77636287, 'node_id': 'MDQ6VXNlcjc3NjM2Mjg3', 'avatar_url': 'https://avatars.githubusercontent.com/u/77636287?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/timapage', 'html_url': 'https://github.com/timapage', 'followers_url': 'https://api.github.com/users/timapage/followers', 'following_url': 'https://api.github.com/users/timapage/following{/other_user}', 'gists_url': 'https://api.github.com/users/timapage/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/timapage/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/timapage/subscriptions', 'organizations_url': 'https://api.github.com/users/timapage/orgs', 'repos_url': 'https://api.github.com/users/timapage/repos', 'events_url': 'https://api.github.com/users/timapage/events{/privacy}', 'received_events_url': 'https://api.github.com/users/timapage/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,2,2024-10-20T20:48:34Z,2024-10-21T13:25:29Z,,NONE,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60077', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60077', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60077.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60077.patch', 'merged_at': None}","- [x] closes #60063 
- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60077/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60077/timeline,,
19,https://api.github.com/repos/pandas-dev/pandas/issues/60076,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60076/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60076/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60076/events,https://github.com/pandas-dev/pandas/pull/60076,2600640950,PR_kwDOAA0YD85_O2mE,60076,CLN: fix pre-commit stage names,"{'login': 'niklasr22', 'id': 75939868, 'node_id': 'MDQ6VXNlcjc1OTM5ODY4', 'avatar_url': 'https://avatars.githubusercontent.com/u/75939868?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/niklasr22', 'html_url': 'https://github.com/niklasr22', 'followers_url': 'https://api.github.com/users/niklasr22/followers', 'following_url': 'https://api.github.com/users/niklasr22/following{/other_user}', 'gists_url': 'https://api.github.com/users/niklasr22/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/niklasr22/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/niklasr22/subscriptions', 'organizations_url': 'https://api.github.com/users/niklasr22/orgs', 'repos_url': 'https://api.github.com/users/niklasr22/repos', 'events_url': 'https://api.github.com/users/niklasr22/events{/privacy}', 'received_events_url': 'https://api.github.com/users/niklasr22/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,0,2024-10-20T16:45:13Z,2024-10-20T16:45:13Z,,NONE,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60076', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60076', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60076.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60076.patch', 'merged_at': None}","Some of the current stage names are [deprecated](https://github.com/pre-commit/pre-commit/issues/2732).

- [ ] closes #xxxx (Replace xxxx with the GitHub issue number)
- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60076/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60076/timeline,,
20,https://api.github.com/repos/pandas-dev/pandas/issues/60075,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60075/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60075/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60075/events,https://github.com/pandas-dev/pandas/issues/60075,2600454763,I_kwDOAA0YD86a_8pr,60075,PERF: DataFrame fragmentation when calling DataFrame.assign() with large kwargs,"{'login': 'y-koj', 'id': 119405103, 'node_id': 'U_kgDOBx36Lw', 'avatar_url': 'https://avatars.githubusercontent.com/u/119405103?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/y-koj', 'html_url': 'https://github.com/y-koj', 'followers_url': 'https://api.github.com/users/y-koj/followers', 'following_url': 'https://api.github.com/users/y-koj/following{/other_user}', 'gists_url': 'https://api.github.com/users/y-koj/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/y-koj/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/y-koj/subscriptions', 'organizations_url': 'https://api.github.com/users/y-koj/orgs', 'repos_url': 'https://api.github.com/users/y-koj/repos', 'events_url': 'https://api.github.com/users/y-koj/events{/privacy}', 'received_events_url': 'https://api.github.com/users/y-koj/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 8935311, 'node_id': 'MDU6TGFiZWw4OTM1MzEx', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Performance', 'name': 'Performance', 'color': 'a10c02', 'default': False, 'description': 'Memory or execution speed performance'}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,3,2024-10-20T13:24:35Z,2024-10-21T19:54:16Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this issue exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this issue exists on the main branch of pandas.


### Reproducible Example

When running the following code, pandas emits PerformanceWarning which describes DataFrame fragmentation.
```py
import pandas as pd
import numpy as np
from timeit import timeit

N = 1_000_000
df = pd.DataFrame({""x"": np.random.rand(N)})

# this part causes fragmentation
dict = {
    ""x_"" + str(key): np.random.rand(N) for key in range(100)
}
df = df.assign(**dict)

# defragmented DataFrame
df2 = df.copy()

print(timeit(lambda: df.sort_values(by=""x_99""), number=10))  # 4.16105025 seconds
print(timeit(lambda: df2.sort_values(by=""x_99""), number=10))  # 2.6979567919999994 seconds
```

#### Note
I guess this problem is caused by the for loop in `DataFrame.assign()` implementation:
https://github.com/pandas-dev/pandas/blob/0691c5cf90477d3503834d983f69350f250a6ff7/pandas/core/frame.py#L5238-L5240

#### Full program output
```sh
$ python pd.py
/Users/yk/tmp/pd.py:11: PerformanceWarning: DataFrame is highly fragmented.  This is usually the result of calling `frame.insert` many times, which has poor performance.  Consider joining all columns at once using pd.concat(axis=1) instead. To get a de-fragmented frame, use `newframe = frame.copy()`
  df = df.assign(**dict)
4.16105025
2.6979567919999994
```


### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.9.6
python-bits           : 64
OS                    : Darwin
OS-release            : 24.0.0
Version               : Darwin Kernel Version 24.0.0: Tue Sep 24 23:38:45 PDT 2024; root:xnu-11215.1.12~1/RELEASE_ARM64_T8122
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : None.UTF-8        

pandas                : 2.2.3
numpy                 : 2.0.2
pytz                  : 2024.2
dateutil              : 2.9.0.post0
pip                   : 24.2
Cython                : None
sphinx                : None
IPython               : None
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.9.0
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.4
lxml.etree            : None
matplotlib            : 3.9.2
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : None
pyreadstat            : None
pytest                : None
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.13.1
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None
</details>


### Prior Performance

_No response_",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60075/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60075/timeline,,
21,https://api.github.com/repos/pandas-dev/pandas/issues/60073,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60073/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60073/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60073/events,https://github.com/pandas-dev/pandas/issues/60073,2598379428,I_kwDOAA0YD86a4B-k,60073,BUG: ArrowDtype Series: Broadcasting Error with Single-Value Arrays in Arithmetic Operations,"{'login': 'hombit', 'id': 1784493, 'node_id': 'MDQ6VXNlcjE3ODQ0OTM=', 'avatar_url': 'https://avatars.githubusercontent.com/u/1784493?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/hombit', 'html_url': 'https://github.com/hombit', 'followers_url': 'https://api.github.com/users/hombit/followers', 'following_url': 'https://api.github.com/users/hombit/following{/other_user}', 'gists_url': 'https://api.github.com/users/hombit/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/hombit/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/hombit/subscriptions', 'organizations_url': 'https://api.github.com/users/hombit/orgs', 'repos_url': 'https://api.github.com/users/hombit/repos', 'events_url': 'https://api.github.com/users/hombit/events{/privacy}', 'received_events_url': 'https://api.github.com/users/hombit/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-18T20:57:49Z,2024-10-18T20:58:22Z,,CONTRIBUTOR,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import numpy as np
import pandas as pd
import pyarrow as pa

series = pd.Series([1.0, 2.0, 3.0], dtype=pd.ArrowDtype(pa.float64()))
series / np.array([2.0])
# ArrowInvalid: Array arguments must all be the same length
```


### Issue Description

When performing arithmetic operations between a `Series` of `ArrowDtype` and a single-value array, the array is not broadcasted to match the series shape. Instead, it raises an `ArrowInvalid error`. This behavior is inconsistent, as the same operation works correctly with both default and numpy-nullable dtypes.

A solution could be casting a single-element array to a `pa.Scalar` in `ArrowExtensionArray._evaluate_op_method`:
https://github.com/pandas-dev/pandas/blob/2a10e04a099d5f1633abcdfbb2dd9fdf09142f8d/pandas/core/arrays/arrow/array.py#L755

### Expected Behavior

The code doesn't fail, and behavior to be consistent over different dtype back-ends

### Installed Versions

Pandas v2.2.3:

<details>

```
INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.12.7
python-bits           : 64
OS                    : Darwin
OS-release            : 24.0.0
Version               : Darwin Kernel Version 24.0.0: Tue Sep 24 23:37:36 PDT 2024; root:xnu-11215.1.12~1/RELEASE_ARM64_T6020
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : en_US.UTF-8
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8
pandas                : 2.2.3
numpy                 : 1.26.4
pytz                  : 2024.1
dateutil              : 2.9.0.post0
pip                   : 24.2
Cython                : None
sphinx                : 7.4.7
IPython               : 8.26.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.6.1
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.4
lxml.etree            : None
matplotlib            : 3.8.4
numba                 : 0.60.0
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : 16.1.0
pyreadstat            : None
pytest                : 8.3.2
python-calamine       : None
pyxlsb                : None
s3fs                  : 2024.6.1
scipy                 : 1.14.0
sqlalchemy            : None
tables                : None
tabulate              : 0.9.0
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.1
qtpy                  : None
pyqt5                 : None
```

</details>

Nightly Pandas:

<details>

```
INSTALLED VERSIONS
------------------
commit                : 2a10e04a099d5f1633abcdfbb2dd9fdf09142f8d
python                : 3.12.7
python-bits           : 64
OS                    : Darwin
OS-release            : 24.0.0
Version               : Darwin Kernel Version 24.0.0: Tue Sep 24 23:37:36 PDT 2024; root:xnu-11215.1.12~1/RELEASE_ARM64_T6020
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : en_US.UTF-8
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 3.0.0.dev0+1579.g2a10e04a09
numpy                 : 2.2.0.dev0+git20241015.961b70f
dateutil              : 2.9.0.post0
pip                   : 24.2
Cython                : None
sphinx                : None
IPython               : 8.28.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : None
lxml.etree            : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
psycopg2              : None
pymysql               : None
pyarrow               : 17.0.0
pyreadstat            : None
pytest                : None
python-calamine       : None
pytz                  : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None
```

</details>",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60073/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60073/timeline,,
22,https://api.github.com/repos/pandas-dev/pandas/issues/60072,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60072/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60072/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60072/events,https://github.com/pandas-dev/pandas/pull/60072,2598266275,PR_kwDOAA0YD85_I9AC,60072,DOC: fix SA01 for pandas.errors.UnsupportedFunctionCall,"{'login': 'tuhinsharma121', 'id': 6801780, 'node_id': 'MDQ6VXNlcjY4MDE3ODA=', 'avatar_url': 'https://avatars.githubusercontent.com/u/6801780?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/tuhinsharma121', 'html_url': 'https://github.com/tuhinsharma121', 'followers_url': 'https://api.github.com/users/tuhinsharma121/followers', 'following_url': 'https://api.github.com/users/tuhinsharma121/following{/other_user}', 'gists_url': 'https://api.github.com/users/tuhinsharma121/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/tuhinsharma121/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/tuhinsharma121/subscriptions', 'organizations_url': 'https://api.github.com/users/tuhinsharma121/orgs', 'repos_url': 'https://api.github.com/users/tuhinsharma121/repos', 'events_url': 'https://api.github.com/users/tuhinsharma121/events{/privacy}', 'received_events_url': 'https://api.github.com/users/tuhinsharma121/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,0,2024-10-18T19:42:59Z,2024-10-18T19:43:04Z,,CONTRIBUTOR,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60072', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60072', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60072.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60072.patch', 'merged_at': None}","fixes

```
pandas.errors.UnsupportedFunctionCall SA01
```",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60072/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60072/timeline,,
23,https://api.github.com/repos/pandas-dev/pandas/issues/60070,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60070/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60070/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60070/events,https://github.com/pandas-dev/pandas/issues/60070,2598019717,I_kwDOAA0YD86a2qKF,60070,PERF: Extreme regression in 2.2 when aggregating a DataFrame with .attrs data,"{'login': 'buhrmann', 'id': 190342, 'node_id': 'MDQ6VXNlcjE5MDM0Mg==', 'avatar_url': 'https://avatars.githubusercontent.com/u/190342?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/buhrmann', 'html_url': 'https://github.com/buhrmann', 'followers_url': 'https://api.github.com/users/buhrmann/followers', 'following_url': 'https://api.github.com/users/buhrmann/following{/other_user}', 'gists_url': 'https://api.github.com/users/buhrmann/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/buhrmann/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/buhrmann/subscriptions', 'organizations_url': 'https://api.github.com/users/buhrmann/orgs', 'repos_url': 'https://api.github.com/users/buhrmann/repos', 'events_url': 'https://api.github.com/users/buhrmann/events{/privacy}', 'received_events_url': 'https://api.github.com/users/buhrmann/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 8935311, 'node_id': 'MDU6TGFiZWw4OTM1MzEx', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Performance', 'name': 'Performance', 'color': 'a10c02', 'default': False, 'description': 'Memory or execution speed performance'}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,2,2024-10-18T17:14:01Z,2024-10-18T18:08:50Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this issue exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this issue exists on the main branch of pandas.


### Reproducible Example

Hi, so it seems some interaction between copy-on-write and .attrs data leads to extremely slow performance, at least with custom aggregations. In the below code, the timed aggregations all perform identical in v2.1. But in v2.2, the last one, with custom .attrs data and copy-on-write enabled, is about 10x slower. Using my original dataset, which I cannot share, but which is simply larger in both dimensions, the result was even more extreme, being almost 50x slower (from less than a second to 40s).

``` python
import numpy as np
import pandas as pd
from sklearn import datasets
from pandas import options as pdopt

print(f""{pd.__version__=}"")

X, y = datasets.fetch_covtype(return_X_y=True, as_frame=True)
X[""group""] = np.random.choice(range(20_000), size=len(X))

print(""\nExecution times with and without metadata before setting copy_on_write to 'warn'"")
%timeit -n1 -r1 X.groupby(""group"").Elevation.apply(lambda ser: (ser >= 3000).sum() / len(ser))
X.attrs[""metadata""] = {col: {""hello"": {""world"": ""foobar""}} for col in X.columns}
%timeit -n1 -r1 X.groupby(""group"").Elevation.apply(lambda ser: (ser >= 3000).sum() / len(ser))

pdopt.mode.copy_on_write = True #""warn""

X, y = datasets.fetch_covtype(return_X_y=True, as_frame=True)
X[""group""] = np.random.choice(range(20_000), size=len(X))

print(""\nExecution times with and without metadata after setting copy_on_write to 'warn'"")
%timeit -n1 -r1 X.groupby(""group"").Elevation.apply(lambda ser: (ser >= 3000).sum() / len(ser))
X.attrs[""metadata""] = {col: {""hello"": {""world"": ""foobar""}} for col in X.columns}
%timeit -n1 -r1 X.groupby(""group"").Elevation.apply(lambda ser: (ser >= 3000).sum() / len(ser))
```

The output:
```
pd.__version__='2.2.3'

Execution times with and without metadata before setting copy_on_write to 'warn'
661 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)
667 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)

Execution times with and without metadata after setting copy_on_write to 'warn'
671 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)
5.22 s  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)
```

### Installed Versions

<details>


INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.10.15
python-bits           : 64
OS                    : Darwin
OS-release            : 24.0.0
Version               : Darwin Kernel Version 24.0.0: Tue Sep 24 23:36:26 PDT 2024; root:xnu-11215.1.12~1/RELEASE_ARM64_T8103
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : None
LANG                  : None
LOCALE                : None.UTF-8

pandas                : 2.2.3
numpy                 : 1.26.4
pytz                  : 2024.1
dateutil              : 2.9.0
pip                   : 24.2
Cython                : 0.29.37
sphinx                : 8.1.3
IPython               : 8.28.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.9.0
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.4
lxml.etree            : 5.3.0
matplotlib            : 3.9.2
numba                 : 0.60.0
numexpr               : None
odfpy                 : None
openpyxl              : 3.1.5
pandas_gbq            : 0.23.0
psycopg2              : 2.9.10
pymysql               : 1.4.6
pyarrow               : 16.1.0
pyreadstat            : 1.2.7
pytest                : 8.3.3
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.11.3
sqlalchemy            : 2.0.36
tables                : None
tabulate              : None
xarray                : None
xlrd                  : 2.0.1
xlsxwriter            : None
zstandard             : 0.23.0
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None

</details>


### Prior Performance

```
pd.__version__='2.1.4'

Execution times with and without metadata before setting copy_on_write to 'warn'
703 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)
695 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)

Execution times with and without metadata after setting copy_on_write to 'warn'
694 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)
691 ms  0 ns per loop (mean  std. dev. of 1 run, 1 loop each)
```",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60070/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60070/timeline,,
24,https://api.github.com/repos/pandas-dev/pandas/issues/60069,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60069/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60069/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60069/events,https://github.com/pandas-dev/pandas/pull/60069,2597932252,PR_kwDOAA0YD85_H9qe,60069,Delete exception from pandas frame,"{'login': 'venikkus', 'id': 74638771, 'node_id': 'MDQ6VXNlcjc0NjM4Nzcx', 'avatar_url': 'https://avatars.githubusercontent.com/u/74638771?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/venikkus', 'html_url': 'https://github.com/venikkus', 'followers_url': 'https://api.github.com/users/venikkus/followers', 'following_url': 'https://api.github.com/users/venikkus/following{/other_user}', 'gists_url': 'https://api.github.com/users/venikkus/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/venikkus/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/venikkus/subscriptions', 'organizations_url': 'https://api.github.com/users/venikkus/orgs', 'repos_url': 'https://api.github.com/users/venikkus/repos', 'events_url': 'https://api.github.com/users/venikkus/events{/privacy}', 'received_events_url': 'https://api.github.com/users/venikkus/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,0,2024-10-18T16:20:46Z,2024-10-18T16:20:46Z,,NONE,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60069', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60069', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60069.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60069.patch', 'merged_at': None}","- [ ] closes #xxxx (Replace xxxx with the GitHub issue number)
- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60069/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60069/timeline,,
25,https://api.github.com/repos/pandas-dev/pandas/issues/60068,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60068/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60068/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60068/events,https://github.com/pandas-dev/pandas/issues/60068,2597515288,I_kwDOAA0YD86a0vAY,60068,BUG: Failures with ArrowDtype(pa.string_view()),"{'login': 'a10y', 'id': 332583, 'node_id': 'MDQ6VXNlcjMzMjU4Mw==', 'avatar_url': 'https://avatars.githubusercontent.com/u/332583?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/a10y', 'html_url': 'https://github.com/a10y', 'followers_url': 'https://api.github.com/users/a10y/followers', 'following_url': 'https://api.github.com/users/a10y/following{/other_user}', 'gists_url': 'https://api.github.com/users/a10y/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/a10y/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/a10y/subscriptions', 'organizations_url': 'https://api.github.com/users/a10y/orgs', 'repos_url': 'https://api.github.com/users/a10y/repos', 'events_url': 'https://api.github.com/users/a10y/events{/privacy}', 'received_events_url': 'https://api.github.com/users/a10y/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,2,2024-10-18T13:24:34Z,2024-10-18T13:32:51Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd # pandas 2.2.3 => latest
import pyarrow as pa # pyarrow 17.0.0 => latest

tab = pa.table({""names"": pa.array([""a"", ""b"", ""c""], type=pa.string_view())})

# this succeeds
tab.to_pandas()

# this throws an exception
tab.to_pandas(types_mapper=pd.ArrowDtype)
```


### Issue Description

Our library is producing Arrow binary view arrays (strings and binary) and we want to allow users to convert into Pandas DataFrame.

We are using the `pd.ArrowDtype` constructor to allow creating Pandas arrays that are backed with Arrow storage. The example I've attached fails also when you change `""c""` to `None` (i.e. problem hits for both nullable and non-nullable types).

Full repro with error message:

```
>>> import pandas as pd # pandas 2.2.3 => latest
>>> import pyarrow as pa # pyarrow 17.0.0 => latest
>>>
>>> tab = pa.table({""names"": pa.array([""a"", ""b"", ""c""], type=pa.string_view())})
>>>
>>> # this succeeds
>>> tab.to_pandas()
  names
0     a
1     b
2     c
>>>
>>> # this throws an exception
>>> tab.to_pandas(types_mapper=pd.ArrowDtype)
Traceback (most recent call last):
  File ""<stdin>"", line 1, in <module>
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/core/frame.py"", line 1214, in __repr__
    return self.to_string(**repr_params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/util/_decorators.py"", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/core/frame.py"", line 1394, in to_string
    return fmt.DataFrameRenderer(formatter).to_string(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/format.py"", line 962, in to_string
    string = string_formatter.to_string()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/string.py"", line 29, in to_string
    text = self._get_string_representation()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/string.py"", line 44, in _get_string_representation
    strcols = self._get_strcols()
              ^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/string.py"", line 35, in _get_strcols
    strcols = self.fmt.get_strcols()
              ^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/format.py"", line 476, in get_strcols
    strcols = self._get_strcols_without_index()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/format.py"", line 729, in _get_strcols_without_index
    str_columns = self._get_formatted_column_labels(self.tr_frame)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/io/formats/format.py"", line 809, in _get_formatted_column_labels
    need_leadsp = dict(zip(fmt_columns, map(is_numeric_dtype, dtypes)))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/core/dtypes/common.py"", line 1119, in is_numeric_dtype
    return _is_dtype_type(
           ^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/core/dtypes/common.py"", line 1468, in _is_dtype_type
    tipo = pandas_dtype(arr_or_dtype).type
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/Volumes/Code/vortex/.venv/lib/python3.11/site-packages/pandas/core/dtypes/dtypes.py"", line 2169, in type
    raise NotImplementedError(pa_type)
NotImplementedError: string_view
>>>
```

This seems like a distinct issue from #59883. 

### Expected Behavior

I'd expect the throwing example to not throw.

### Installed Versions

<details>

**Device:** macOS 14.4.1 M2 Max MBP

```
>>> pd.show_versions()

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.11.9
python-bits           : 64
OS                    : Darwin
OS-release            : 23.4.0
Version               : Darwin Kernel Version 23.4.0: Fri Mar 15 00:12:49 PDT 2024; root:xnu-10063.101.17~1/RELEASE_ARM64_T6020
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : en_US.UTF-8
LANG                  : None
LOCALE                : en_US.UTF-8

pandas                : 2.2.3
numpy                 : 1.26.4
pytz                  : 2024.1
dateutil              : 2.9.0.post0
pip                   : 24.0
Cython                : None
sphinx                : 8.0.2
IPython               : 8.26.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.3
lxml.etree            : None
matplotlib            : 3.9.2
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : 17.0.0
pyreadstat            : None
pytest                : 8.1.1
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : 2024.7.0
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2024.1
qtpy                  : None
pyqt5                 : None

```

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60068/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60068/timeline,,
26,https://api.github.com/repos/pandas-dev/pandas/issues/60067,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60067/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60067/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60067/events,https://github.com/pandas-dev/pandas/pull/60067,2596954088,PR_kwDOAA0YD85_E4_g,60067,Testing ,"{'login': 'Saumya0206', 'id': 60199756, 'node_id': 'MDQ6VXNlcjYwMTk5NzU2', 'avatar_url': 'https://avatars.githubusercontent.com/u/60199756?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/Saumya0206', 'html_url': 'https://github.com/Saumya0206', 'followers_url': 'https://api.github.com/users/Saumya0206/followers', 'following_url': 'https://api.github.com/users/Saumya0206/following{/other_user}', 'gists_url': 'https://api.github.com/users/Saumya0206/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/Saumya0206/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/Saumya0206/subscriptions', 'organizations_url': 'https://api.github.com/users/Saumya0206/orgs', 'repos_url': 'https://api.github.com/users/Saumya0206/repos', 'events_url': 'https://api.github.com/users/Saumya0206/events{/privacy}', 'received_events_url': 'https://api.github.com/users/Saumya0206/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}",[],open,False,,[],,0,2024-10-18T09:18:45Z,2024-10-18T10:29:27Z,,NONE,,False,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/pulls/60067', 'html_url': 'https://github.com/pandas-dev/pandas/pull/60067', 'diff_url': 'https://github.com/pandas-dev/pandas/pull/60067.diff', 'patch_url': 'https://github.com/pandas-dev/pandas/pull/60067.patch', 'merged_at': None}","- [ ] closes #xxxx (Replace xxxx with the GitHub issue number)
- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature
- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).
- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.
- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60067/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60067/timeline,,
27,https://api.github.com/repos/pandas-dev/pandas/issues/60066,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60066/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60066/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60066/events,https://github.com/pandas-dev/pandas/issues/60066,2596277883,I_kwDOAA0YD86awA57,60066,"PERF: df.astype(""float64[pyarrow]"") is slow, df.astype(""Float64"") is super slow","{'login': 'auderson', 'id': 48577571, 'node_id': 'MDQ6VXNlcjQ4NTc3NTcx', 'avatar_url': 'https://avatars.githubusercontent.com/u/48577571?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/auderson', 'html_url': 'https://github.com/auderson', 'followers_url': 'https://api.github.com/users/auderson/followers', 'following_url': 'https://api.github.com/users/auderson/following{/other_user}', 'gists_url': 'https://api.github.com/users/auderson/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/auderson/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/auderson/subscriptions', 'organizations_url': 'https://api.github.com/users/auderson/orgs', 'repos_url': 'https://api.github.com/users/auderson/repos', 'events_url': 'https://api.github.com/users/auderson/events{/privacy}', 'received_events_url': 'https://api.github.com/users/auderson/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 8935311, 'node_id': 'MDU6TGFiZWw4OTM1MzEx', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Performance', 'name': 'Performance', 'color': 'a10c02', 'default': False, 'description': 'Memory or execution speed performance'}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,0,2024-10-18T03:03:51Z,2024-10-18T03:03:51Z,,CONTRIBUTOR,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this issue exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this issue exists on the main branch of pandas.


### Reproducible Example

```python
import pandas as pd
import numpy as np

df = pd.DataFrame(np.zeros((5000, 5000)))
```
```python
%%time
_ = df.astype(""Float64"")
```
CPU times: user 3.87 s, sys: 185 ms, total: 4.05 s
Wall time: 4.05 s

```python
%%timeit
_ = df.astype(""float64[pyarrow]"")
```
566 ms  15.3 ms per loop (mean  std. dev. of 7 runs, 1 loop each)

```python
%%timeit
_ = df.astype(""float64"", copy=True)
```
148 ms  984 s per loop (mean  std. dev. of 7 runs, 10 loops each)

It takes over 4s for a middle-sized dataframe of 5000 x 5000 to convert to `Float64`, while `float64[pyarrow]` is about 7x faster. The fastest `float64` takes only 150ms, even with `copy` enabled.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.10.14
python-bits           : 64
OS                    : Linux
OS-release            : 5.15.0-122-generic
Version               : #132-Ubuntu SMP Thu Aug 29 13:45:52 UTC 2024
machine               : x86_64
processor             : x86_64
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 2.2.3
numpy                 : 1.26.4
pytz                  : 2024.1
dateutil              : 2.9.0
pip                   : 24.0
Cython                : 3.0.7
sphinx                : 7.3.7
IPython               : 8.25.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.6.0
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : 3.1.4
lxml.etree            : None
matplotlib            : 3.9.2
numba                 : 0.60.0
numexpr               : 2.10.0
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : 2.9.9
pymysql               : 1.4.6
pyarrow               : 16.1.0
pyreadstat            : None
pytest                : 8.2.2
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.14.0
sqlalchemy            : 2.0.31
tables                : 3.9.2
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : 0.22.0
tzdata                : 2024.1
qtpy                  : 2.4.1
pyqt5                 : None
</details>


### Prior Performance

_No response_",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60066/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60066/timeline,,
28,https://api.github.com/repos/pandas-dev/pandas/issues/60065,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60065/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60065/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60065/events,https://github.com/pandas-dev/pandas/issues/60065,2595494947,I_kwDOAA0YD86atBwj,60065,"BUG: `str.split("""")` gives extra leading and trailing elements","{'login': 'NickCrews', 'id': 10820686, 'node_id': 'MDQ6VXNlcjEwODIwNjg2', 'avatar_url': 'https://avatars.githubusercontent.com/u/10820686?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/NickCrews', 'html_url': 'https://github.com/NickCrews', 'followers_url': 'https://api.github.com/users/NickCrews/followers', 'following_url': 'https://api.github.com/users/NickCrews/following{/other_user}', 'gists_url': 'https://api.github.com/users/NickCrews/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/NickCrews/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/NickCrews/subscriptions', 'organizations_url': 'https://api.github.com/users/NickCrews/orgs', 'repos_url': 'https://api.github.com/users/NickCrews/repos', 'events_url': 'https://api.github.com/users/NickCrews/events{/privacy}', 'received_events_url': 'https://api.github.com/users/NickCrews/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,7,2024-10-17T18:53:02Z,2024-10-21T04:02:09Z,,CONTRIBUTOR,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd

vals = [""foo"", """", None]
pd.Series(vals).str.split("""").tolist()
# actual: [['', 'f', 'o', 'o', ''], ['', ''], None]
# expected option A, see below: [['f', 'o', 'o'], [], None]
# expected option B, see below: [['f', 'o', 'o'], [''], None]
```


### Issue Description

While I think the current behavior is definitely wrong, I'm not sure if expected behavior should be A or B from above. Here is a brief survey of what peers do:
- Using vanilla python, eg `""foo"".split("""")`, gives an error (I should use `list(""foo"")` instead)
- In duckdb, `STR_SPLIT(vals, '')` gives `[['f', 'o', 'o'], [''], None]`
- in polars, `vals.str.split("""")` gives `[['f', 'o', 'o'], [], None]`

See https://github.com/duckdb/duckdb/issues/14414 for a discussion of pros and cons of both.



### Expected Behavior

In the above linked duckdb issue I argue for why behavior A I think is best.

### Installed Versions

<details>


INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.11.6
python-bits           : 64
OS                    : Darwin
OS-release            : 23.6.0
Version               : Darwin Kernel Version 23.6.0: Mon Jul 29 21:14:30 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T6000
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : None
LANG                  : None
LOCALE                : None.UTF-8

pandas                : 2.2.3
numpy                 : 2.1.2
pytz                  : 2024.2
dateutil              : 2.9.0.post0
pip                   : 23.2.1
Cython                : None
sphinx                : None
IPython               : 8.28.0
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : 4.12.3
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : 2024.9.0
html5lib              : None
hypothesis            : 6.115.0
gcsfs                 : 2024.9.0post1
jinja2                : 3.1.4
lxml.etree            : None
matplotlib            : 3.9.2
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : 2.9.9
pymysql               : 1.4.6
pyarrow               : 17.0.0
pyreadstat            : None
pytest                : 8.3.3
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : 1.14.1
sqlalchemy            : 2.0.35
tables                : None
tabulate              : 0.9.0
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : 0.23.0
tzdata                : 2024.2
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60065/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60065/timeline,,
29,https://api.github.com/repos/pandas-dev/pandas/issues/60064,https://api.github.com/repos/pandas-dev/pandas,https://api.github.com/repos/pandas-dev/pandas/issues/60064/labels{/name},https://api.github.com/repos/pandas-dev/pandas/issues/60064/comments,https://api.github.com/repos/pandas-dev/pandas/issues/60064/events,https://github.com/pandas-dev/pandas/issues/60064,2595292260,I_kwDOAA0YD86asQRk,60064,"BUG: DataFrame(data=[None, 1], dtype='timedelta64[ns]') raises ValueError: Buffer has wrong number of dimensions","{'login': 'sfc-gh-mvashishtha', 'id': 149194323, 'node_id': 'U_kgDOCOSGUw', 'avatar_url': 'https://avatars.githubusercontent.com/u/149194323?v=4', 'gravatar_id': '', 'url': 'https://api.github.com/users/sfc-gh-mvashishtha', 'html_url': 'https://github.com/sfc-gh-mvashishtha', 'followers_url': 'https://api.github.com/users/sfc-gh-mvashishtha/followers', 'following_url': 'https://api.github.com/users/sfc-gh-mvashishtha/following{/other_user}', 'gists_url': 'https://api.github.com/users/sfc-gh-mvashishtha/gists{/gist_id}', 'starred_url': 'https://api.github.com/users/sfc-gh-mvashishtha/starred{/owner}{/repo}', 'subscriptions_url': 'https://api.github.com/users/sfc-gh-mvashishtha/subscriptions', 'organizations_url': 'https://api.github.com/users/sfc-gh-mvashishtha/orgs', 'repos_url': 'https://api.github.com/users/sfc-gh-mvashishtha/repos', 'events_url': 'https://api.github.com/users/sfc-gh-mvashishtha/events{/privacy}', 'received_events_url': 'https://api.github.com/users/sfc-gh-mvashishtha/received_events', 'type': 'User', 'user_view_type': 'public', 'site_admin': False}","[{'id': 76811, 'node_id': 'MDU6TGFiZWw3NjgxMQ==', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Bug', 'name': 'Bug', 'color': 'e10c02', 'default': False, 'description': None}, {'id': 1954720290, 'node_id': 'MDU6TGFiZWwxOTU0NzIwMjkw', 'url': 'https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage', 'name': 'Needs Triage', 'color': '0052cc', 'default': False, 'description': 'Issue that has not been reviewed by a pandas team member'}]",open,False,,[],,1,2024-10-17T17:10:59Z,2024-10-22T03:54:48Z,,NONE,,,,"### Pandas version checks

- [X] I have checked that this issue has not already been reported.

- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.

- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.


### Reproducible Example

```python
import pandas as pd
df = pd.DataFrame([None, 1], dtype='timedelta64[ns]')
```


### Issue Description

The error message doesn't tell the user what to do differently. Also, it's possible that there shouldn't be an error at all.

### Expected Behavior

I think this should be allowed, in which case the resulting series would look like

```
                          0
0                       NaT
1 0 days 00:00:00.000000001
```

If it's not allowed, the error message should be clearer.

### Installed Versions

<details>

INSTALLED VERSIONS
------------------
commit                : 0691c5cf90477d3503834d983f69350f250a6ff7
python                : 3.9.18
python-bits           : 64
OS                    : Darwin
OS-release            : 23.6.0
Version               : Darwin Kernel Version 23.6.0: Wed Jul 31 20:48:52 PDT 2024; root:xnu-10063.141.1.700.5~1/RELEASE_ARM64_T6020
machine               : arm64
processor             : arm
byteorder             : little
LC_ALL                : None
LANG                  : en_US.UTF-8
LOCALE                : en_US.UTF-8

pandas                : 2.2.3
numpy                 : 1.26.3
pytz                  : 2023.3.post1
dateutil              : 2.8.2
pip                   : 23.3.1
Cython                : None
sphinx                : None
IPython               : 8.18.1
adbc-driver-postgresql: None
adbc-driver-sqlite    : None
bs4                   : None
blosc                 : None
bottleneck            : None
dataframe-api-compat  : None
fastparquet           : None
fsspec                : None
html5lib              : None
hypothesis            : None
gcsfs                 : None
jinja2                : None
lxml.etree            : None
matplotlib            : None
numba                 : None
numexpr               : None
odfpy                 : None
openpyxl              : None
pandas_gbq            : None
psycopg2              : None
pymysql               : None
pyarrow               : None
pyreadstat            : None
pytest                : 8.3.2
python-calamine       : None
pyxlsb                : None
s3fs                  : None
scipy                 : None
sqlalchemy            : None
tables                : None
tabulate              : None
xarray                : None
xlrd                  : None
xlsxwriter            : None
zstandard             : None
tzdata                : 2023.4
qtpy                  : None
pyqt5                 : None

</details>
",,"{'url': 'https://api.github.com/repos/pandas-dev/pandas/issues/60064/reactions', 'total_count': 0, '+1': 0, '-1': 0, 'laugh': 0, 'hooray': 0, 'confused': 0, 'heart': 0, 'rocket': 0, 'eyes': 0}",https://api.github.com/repos/pandas-dev/pandas/issues/60064/timeline,,
